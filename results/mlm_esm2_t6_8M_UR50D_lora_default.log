CUDA available: False
Number of GPUs: 0
Namespace(objective='mlm', default=True, optim=False, inp_path='data/fluorescence_homologs.fasta', out_path='results/mlm_esm2_t6_8M_UR50D_lora_default', seqcol='sequence', ycol='label', truncate=1.0, checkpoint='facebook/esm2_t6_8M_UR50D', full=False, lora_r=4, lora_alpha=1, lora_weights='qkvo', lora_dropout=0.0, epochs=20, lr=1e-05, batch=8, accum=1, val_batch=8, seed=42, num_labels=1, earlystop=False, n_trials1=3, n_trials2=3)
PERFORM LORA FINETUNING...
device: cpu
Given input is a local file. Data splits will be created...
DatasetDict({
    train: Dataset({
        features: ['id', 'sequence', 'input_ids', 'attention_mask'],
        num_rows: 467
    })
    valid: Dataset({
        features: ['id', 'sequence', 'input_ids', 'attention_mask'],
        num_rows: 117
    })
    test: Dataset({
        features: ['id', 'sequence', 'input_ids', 'attention_mask'],
        num_rows: 147
    })
})
Model used: facebook/esm2_t6_8M_UR50D 

Early stopping NOT implemented.
full model :  7512474
lora model :  276194
{'loss': 7.535, 'grad_norm': 17.332674026489258, 'learning_rate': 1.1600000000000001e-06, 'epoch': 1.0}
{'eval_loss': 8.223556518554688, 'eval_accuracy': 0.13365973072215423, 'eval_runtime': 1.1209, 'eval_samples_per_second': 104.378, 'eval_steps_per_second': 13.382, 'epoch': 1.0}
{'loss': 7.4535, 'grad_norm': 8.837228775024414, 'learning_rate': 2.3400000000000005e-06, 'epoch': 2.0}
{'eval_loss': 8.085957527160645, 'eval_accuracy': 0.13519980856664274, 'eval_runtime': 1.0481, 'eval_samples_per_second': 111.629, 'eval_steps_per_second': 14.311, 'epoch': 2.0}
{'loss': 7.289, 'grad_norm': 3.1610121726989746, 'learning_rate': 3.52e-06, 'epoch': 3.0}
{'eval_loss': 8.169498443603516, 'eval_accuracy': 0.13540929464496343, 'eval_runtime': 1.0517, 'eval_samples_per_second': 111.245, 'eval_steps_per_second': 14.262, 'epoch': 3.0}
{'loss': 7.2865, 'grad_norm': 10.569173812866211, 'learning_rate': 4.7e-06, 'epoch': 4.0}
{'eval_loss': 8.14832592010498, 'eval_accuracy': 0.1305470767785865, 'eval_runtime': 1.044, 'eval_samples_per_second': 112.067, 'eval_steps_per_second': 14.368, 'epoch': 4.0}
{'loss': 7.1627, 'grad_norm': 3.4484000205993652, 'learning_rate': 5.8800000000000005e-06, 'epoch': 5.0}
{'eval_loss': 7.84826135635376, 'eval_accuracy': 0.12505989458552946, 'eval_runtime': 1.0516, 'eval_samples_per_second': 111.259, 'eval_steps_per_second': 14.264, 'epoch': 5.0}
{'loss': 7.0063, 'grad_norm': 1.4048701524734497, 'learning_rate': 7.06e-06, 'epoch': 6.0}
{'eval_loss': 7.914702415466309, 'eval_accuracy': 0.14147051686483864, 'eval_runtime': 1.0543, 'eval_samples_per_second': 110.974, 'eval_steps_per_second': 14.227, 'epoch': 6.0}
{'loss': 6.9836, 'grad_norm': 1.3115981817245483, 'learning_rate': 8.24e-06, 'epoch': 7.0}
{'eval_loss': 7.693717002868652, 'eval_accuracy': 0.13297613248904042, 'eval_runtime': 1.0455, 'eval_samples_per_second': 111.911, 'eval_steps_per_second': 14.348, 'epoch': 7.0}
{'loss': 6.9165, 'grad_norm': 5.238890171051025, 'learning_rate': 9.42e-06, 'epoch': 8.0}
{'eval_loss': 7.514662742614746, 'eval_accuracy': 0.13275193798449614, 'eval_runtime': 1.0504, 'eval_samples_per_second': 111.388, 'eval_steps_per_second': 14.281, 'epoch': 8.0}
{'loss': 6.6922, 'grad_norm': 3.8141188621520996, 'learning_rate': 9.952052154376027e-06, 'epoch': 9.0}
{'eval_loss': 7.265377044677734, 'eval_accuracy': 0.14320388349514562, 'eval_runtime': 1.0487, 'eval_samples_per_second': 111.563, 'eval_steps_per_second': 14.303, 'epoch': 9.0}
{'loss': 6.3932, 'grad_norm': 9.049360275268555, 'learning_rate': 9.583251048640941e-06, 'epoch': 10.0}
{'eval_loss': 6.951920032501221, 'eval_accuracy': 0.13449740443605473, 'eval_runtime': 1.1342, 'eval_samples_per_second': 103.159, 'eval_steps_per_second': 13.226, 'epoch': 10.0}
{'loss': 6.0793, 'grad_norm': 1.120962381362915, 'learning_rate': 8.87601988055565e-06, 'epoch': 11.0}
{'eval_loss': 6.45037841796875, 'eval_accuracy': 0.13843529125030465, 'eval_runtime': 1.0752, 'eval_samples_per_second': 108.821, 'eval_steps_per_second': 13.951, 'epoch': 11.0}
{'loss': 5.8507, 'grad_norm': 4.159235000610352, 'learning_rate': 7.882581032392252e-06, 'epoch': 12.0}
{'eval_loss': 6.126387596130371, 'eval_accuracy': 0.1326676176890157, 'eval_runtime': 1.0473, 'eval_samples_per_second': 111.713, 'eval_steps_per_second': 14.322, 'epoch': 12.0}
{'loss': 5.5146, 'grad_norm': 6.845660209655762, 'learning_rate': 6.67629063667697e-06, 'epoch': 13.0}
{'eval_loss': 5.985915184020996, 'eval_accuracy': 0.12988929889298892, 'eval_runtime': 1.0546, 'eval_samples_per_second': 110.938, 'eval_steps_per_second': 14.223, 'epoch': 13.0}
{'loss': 5.4083, 'grad_norm': 8.702247619628906, 'learning_rate': 5.346221914470959e-06, 'epoch': 14.0}
{'eval_loss': 5.703431606292725, 'eval_accuracy': 0.13374844333748442, 'eval_runtime': 1.0492, 'eval_samples_per_second': 111.511, 'eval_steps_per_second': 14.296, 'epoch': 14.0}
{'loss': 5.2334, 'grad_norm': 3.4750587940216064, 'learning_rate': 3.99058795421495e-06, 'epoch': 15.0}
{'eval_loss': 5.68225622177124, 'eval_accuracy': 0.1252663982950509, 'eval_runtime': 1.0915, 'eval_samples_per_second': 107.195, 'eval_steps_per_second': 13.743, 'epoch': 15.0}
{'loss': 5.2155, 'grad_norm': 4.743105888366699, 'learning_rate': 2.7094895971730326e-06, 'epoch': 16.0}
{'eval_loss': 5.476217746734619, 'eval_accuracy': 0.13184438040345822, 'eval_runtime': 1.046, 'eval_samples_per_second': 111.853, 'eval_steps_per_second': 14.34, 'epoch': 16.0}
{'loss': 5.0527, 'grad_norm': 4.040542125701904, 'learning_rate': 1.5975239300526924e-06, 'epoch': 17.0}
{'eval_loss': 5.325760364532471, 'eval_accuracy': 0.1308411214953271, 'eval_runtime': 1.0474, 'eval_samples_per_second': 111.705, 'eval_steps_per_second': 14.321, 'epoch': 17.0}
{'loss': 5.0311, 'grad_norm': 4.074334621429443, 'learning_rate': 7.367991782295392e-07, 'epoch': 18.0}
{'eval_loss': 5.421590328216553, 'eval_accuracy': 0.12185176301271287, 'eval_runtime': 1.0443, 'eval_samples_per_second': 112.042, 'eval_steps_per_second': 14.364, 'epoch': 18.0}
{'loss': 5.052, 'grad_norm': 2.2677812576293945, 'learning_rate': 1.908717841359048e-07, 'epoch': 19.0}
{'eval_loss': 5.38252067565918, 'eval_accuracy': 0.1336621454993835, 'eval_runtime': 1.0464, 'eval_samples_per_second': 111.815, 'eval_steps_per_second': 14.335, 'epoch': 19.0}
{'loss': 5.0631, 'grad_norm': 1.820997953414917, 'learning_rate': 5.336065552641323e-11, 'epoch': 20.0}
{'eval_loss': 5.250477313995361, 'eval_accuracy': 0.13989637305699482, 'eval_runtime': 1.0507, 'eval_samples_per_second': 111.359, 'eval_steps_per_second': 14.277, 'epoch': 20.0}
{'train_runtime': 203.7419, 'train_samples_per_second': 45.842, 'train_steps_per_second': 5.792, 'train_loss': 6.210956922628112, 'epoch': 20.0}
test perplexity: 153.90968754431688
test score: 0.15269631031220435
Time taken:  209.68453335762024 sec.
